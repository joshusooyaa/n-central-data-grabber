<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-Central Data Grabber - System Overview</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .overview-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-top: 20px;
            min-height: 500px; /* Ensure minimum height */
        }
        .header {
            margin-bottom: 30px;
            text-align: center;
        }
        .monitoring-section {
            margin: 40px 0;
            padding: 20px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .metric-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: center;
            transition: transform 0.2s;
        }
        .metric-card:hover {
            transform: translateY(-5px);
        }
        .metric-icon {
            font-size: 2em;
            margin-bottom: 10px;
            color: #0d6efd;
        }
        .timeline {
            position: relative;
            padding: 20px 0;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #0d6efd;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }
        .timeline-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 0 20px;
        }
        .timeline-icon {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            background: #0d6efd;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: -20px;
        }
        .nav-tabs {
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 20px;
        }
        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
            padding: 10px 20px;
            margin-right: 10px;
            border-radius: 5px 5px 0 0;
        }
        .nav-tabs .nav-link.active {
            color: #0d6efd;
            background-color: white;
            border-bottom: 2px solid #0d6efd;
        }
        .flow-step {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        .flow-step::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            width: 2px;
            height: 20px;
            background: #0d6efd;
        }
        .flow-step:last-child::after {
            display: none;
        }
        .flow-icon {
            font-size: 2em;
            color: #0d6efd;
            margin-bottom: 15px;
        }
        .flow-details {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .flow-details ul {
            margin: 0;
            padding-left: 20px;
        }
        .flow-graph {
            position: relative;
            padding: 40px 0;
        }
        .flow-node {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px auto;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            max-width: 600px;
            text-align: center;
        }
        .flow-node::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            width: 2px;
            height: 20px;
            background: #0d6efd;
        }
        .flow-node:first-child::before {
            display: none;
        }
        .flow-node-icon {
            font-size: 2em;
            color: #0d6efd;
            margin-bottom: 15px;
        }
        .flow-node-content {
            margin-top: 15px;
        }
        .flow-node-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .flow-arrow {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            color: #0d6efd;
            font-size: 1.5em;
            margin-top: -10px;
        }
        .data-flow {
            position: relative;
            margin: 20px 0;
        }
        .data-flow-line {
            position: absolute;
            left: 50%;
            width: 2px;
            background: #0d6efd;
            transform: translateX(-50%);
        }
        .data-flow-content {
            position: relative;
            z-index: 1;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px auto;
            max-width: 600px;
        }
        .tab-content {
            padding: 20px 0;
        }
        .tab-pane {
            min-height: 400px; /* Ensure minimum height for tab content */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>N-Central Data Grabber System Overview</h1>
            <p class="lead">Monitoring and Reporting System for Device Performance Metrics</p>
            <a href="/" class="btn btn-outline-primary"><i class="fas fa-arrow-left"></i> Back to Configuration</a>
        </div>

        <div class="overview-container">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">Overview</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="flow-tab" data-bs-toggle="tab" data-bs-target="#flow" type="button" role="tab" aria-controls="flow" aria-selected="false">System Flow</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="api-flow-tab" data-bs-toggle="tab" data-bs-target="#api-flow" type="button" role="tab" aria-controls="api-flow" aria-selected="false">API & Data Flow</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="comprehensive-tab" data-bs-toggle="tab" data-bs-target="#comprehensive" type="button" role="tab" aria-controls="comprehensive" aria-selected="false">Comprehensive Flow</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="activity-tab" data-bs-toggle="tab" data-bs-target="#activity" type="button" role="tab" aria-controls="activity" aria-selected="false">Activity Diagram</button>
                </li>
            </ul>

            <div class="tab-content" id="myTabContent">
                <!-- Overview Tab -->
                <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                    <div class="monitoring-section">
                        <h2 class="text-center mb-4">Device Monitoring</h2>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <i class="fas fa-microchip metric-icon"></i>
                                    <h5>CPU Usage</h5>
                                    <p>Processor performance metrics</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <i class="fas fa-memory metric-icon"></i>
                                    <h5>Memory Usage</h5>
                                    <p>RAM utilization statistics</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <i class="fas fa-hdd metric-icon"></i>
                                    <h5>Disk Space</h5>
                                    <p>Storage capacity and usage</p>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <i class="fas fa-network-wired metric-icon"></i>
                                    <h5>Connectivity</h5>
                                    <p>Network status and performance</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="timeline-content">
                                <h4>5-Minute Polling</h4>
                                <p>Each device is monitored every 5 minutes, collecting performance metrics for CPU, Memory, Disk, and Connectivity.</p>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="timeline-content">
                                <h4>Data Storage</h4>
                                <p>All collected metrics are stored in a MySQL database, organized by device and timestamp for easy retrieval.</p>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="timeline-content">
                                <h4>Reporting</h4>
                                <p>OPS Reports automatically fetch and analyze the stored data on a weekly and monthly basis to track performance trends and identify potential issues.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Flow Tab -->
                <div class="tab-pane fade" id="flow" role="tabpanel" aria-labelledby="flow-tab">
                    <div class="flow-diagram" style="padding: 20px;">
                        <!-- Monitor Service Box -->
                        <div class="service-container" style="
                            background: #f5f5dc;
                            border: 2px solid #d3d3d3;
                            border-radius: 10px;
                            padding: 20px;
                            margin: 20px;
                            width: 400px;
                            position: relative;
                        ">
                            <h4 class="text-center mb-4">datamonitor.service</h4>
                            
                            <!-- Inner Monitor Box -->
                            <div style="
                                background: white;
                                border: 2px solid #d3d3d3;
                                border-radius: 8px;
                                padding: 15px;
                                margin: 10px 0;
                            ">
                                <!-- Status Check Flow -->
                                <div class="text-center mb-3">
                                    <div class="btn btn-light border mb-2">Check Status</div>
                                    <div style="display: flex; justify-content: space-around; align-items: center;">
                                        <div class="btn btn-light border" style="width: 80px;">False</div>
                                        <div style="font-size: 24px;">â†”</div>
                                        <div class="btn btn-light border" style="width: 80px;">True</div>
                                    </div>
                                </div>
                                
                                <!-- Action Steps -->
                                <div class="text-center">
                                    <div class="btn btn-light border mb-2">Open Ticket(s)</div>
                                    <div class="btn btn-light border">Attempt Restart</div>
                                </div>
                            </div>
                            
                            <!-- Timer Indicator -->
                            <div style="
                                position: absolute;
                                left: -80px;
                                top: 50%;
                                transform: translateY(-50%);
                                background: #8b7355;
                                color: white;
                                padding: 10px;
                                border-radius: 8px;
                                text-align: center;
                            ">
                                Every<br>minute
                            </div>
                        </div>

                        <!-- Data Collection Box -->
                        <div class="data-flow-container" style="
                            background: #f5f5dc;
                            border: 2px solid #d3d3d3;
                            border-radius: 10px;
                            padding: 20px;
                            margin: 20px;
                            width: 400px;
                            position: relative;
                            left: 100px;
                        ">
                            <div style="
                                position: absolute;
                                left: -20px;
                                top: -30px;
                                background: #fff3cd;
                                padding: 8px;
                                border-radius: 4px;
                                border: 1px solid #ffeeba;
                            ">
                                Data Collection Flow
                            </div>

                            <!-- Timer Box -->
                            <div style="
                                position: absolute;
                                left: -80px;
                                top: 50%;
                                transform: translateY(-50%);
                                background: #8b7355;
                                color: white;
                                padding: 10px;
                                border-radius: 8px;
                                text-align: center;
                            ">
                                Every 5<br>Minutes
                            </div>

                            <!-- Flow Steps -->
                            <div class="text-center">
                                <div class="btn btn-light border mb-3">Initialize API Keys</div>
                                <div class="btn btn-light border mb-3">Get Devices</div>
                                <div style="
                                    background: #282828;
                                    color: #ff69b4;
                                    padding: 8px;
                                    border-radius: 4px;
                                    margin: 10px 0;
                                    font-family: monospace;
                                ">
                                    foreach device
                                </div>
                                <div style="
                                    background: #282828;
                                    color: #ff69b4;
                                    padding: 8px;
                                    border-radius: 4px;
                                    margin: 10px 0;
                                    font-family: monospace;
                                ">
                                    foreach metric
                                </div>
                                <div class="btn btn-light border mb-3">Get Data</div>
                            </div>
                        </div>

                        <!-- Database -->
                        <div style="
                            position: absolute;
                            right: 100px;
                            top: 50%;
                            transform: translateY(-50%);
                        ">
                            <div style="
                                width: 120px;
                                height: 150px;
                                background: white;
                                border: 2px solid #d3d3d3;
                                border-radius: 10px 10px 0 0;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-weight: bold;
                            ">
                                Database
                            </div>
                            <div style="
                                width: 140px;
                                height: 20px;
                                background: #d3d3d3;
                                border: 2px solid #d3d3d3;
                                border-radius: 0 0 20px 20px;
                                margin: 0 -10px;
                            "></div>
                        </div>

                        <!-- N-Central Server Cloud -->
                        <div style="
                            position: absolute;
                            right: 100px;
                            top: 150px;
                            background: #f0f8ff;
                            border: 2px solid #b0c4de;
                            border-radius: 30px;
                            padding: 20px;
                            min-width: 200px;
                            text-align: center;
                            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                        ">
                            <h5>N-Central Server</h5>
                            <div class="mt-2">
                                <div class="btn btn-light border mb-2">Return data</div>
                                <div style="display: flex; justify-content: center; gap: 10px;">
                                    <div class="btn btn-light border" style="width: 60px;">No</div>
                                    <div class="btn btn-light border" style="width: 60px;">Error?</div>
                                    <div class="btn btn-light border" style="width: 60px;">Yes</div>
                                </div>
                                <div class="btn btn-light border mt-2">Script Stops</div>
                            </div>
                        </div>

                        <!-- Connecting Lines -->
                        <svg style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
                            <!-- Data Flow to Database -->
                            <line x1="500" y1="300" x2="700" y2="300" style="stroke:#4CAF50;stroke-width:2" marker-end="url(#arrow)" />
                            <!-- Data Flow to N-Central -->
                            <line x1="500" y1="200" x2="700" y2="200" style="stroke:#2196F3;stroke-width:2" marker-end="url(#arrow)" />
                            <defs>
                                <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#000" />
                                </marker>
                            </defs>
                        </svg>
                    </div>
                </div>

                <!-- API & Data Flow Tab -->
                <div class="tab-pane fade" id="api-flow" role="tabpanel" aria-labelledby="api-flow-tab">
                    <div class="flow-chart-2d" style="
                        display: grid;
                        grid-template-columns: repeat(3, 1fr);
                        grid-template-rows: repeat(3, 1fr);
                        gap: 20px;
                        padding: 20px;
                        position: relative;
                        min-height: 500px;
                    ">
                        <!-- API Section -->
                        <div class="flow-group" style="
                            grid-column: 1;
                            grid-row: 1 / span 2;
                            background: #e3f2fd;
                            border-radius: 8px;
                            padding: 15px;
                            position: relative;
                        ">
                            <h5 class="text-center mb-3">API Connection</h5>
                            <div class="flow-step" style="margin-bottom: 10px;">
                                <i class="fas fa-cog"></i>
                                <h6>Script Start</h6>
                            </div>
                            <div class="flow-step" style="margin-bottom: 10px;">
                                <i class="fas fa-server"></i>
                                <h6>Connect to N-Central</h6>
                            </div>
                            <div class="flow-step">
                                <i class="fas fa-desktop"></i>
                                <h6>Get Device List</h6>
                            </div>
                        </div>

                        <!-- Data Collection Section -->
                        <div class="flow-group" style="
                            grid-column: 2;
                            grid-row: 2;
                            background: #e8f5e9;
                            border-radius: 8px;
                            padding: 15px;
                            position: relative;
                        ">
                            <h5 class="text-center mb-3">Data Collection</h5>
                            <div class="flow-step">
                                <i class="fas fa-microchip"></i>
                                <h6>Collect Metrics</h6>
                            </div>
                        </div>

                        <!-- Storage Section -->
                        <div class="flow-group" style="
                            grid-column: 3;
                            grid-row: 1 / span 2;
                            background: #fff3e0;
                            border-radius: 8px;
                            padding: 15px;
                            position: relative;
                        ">
                            <h5 class="text-center mb-3">Storage</h5>
                            <div class="flow-step" style="margin-bottom: 10px;">
                                <i class="fas fa-database"></i>
                                <h6>Store Data</h6>
                            </div>
                            <div class="flow-step">
                                <i class="fas fa-chart-line"></i>
                                <h6>Update Records</h6>
                            </div>
                        </div>

                        <!-- Loop Section -->
                        <div class="flow-group" style="
                            grid-column: 2;
                            grid-row: 3;
                            background: #fce4ec;
                            border-radius: 8px;
                            padding: 15px;
                            position: relative;
                        ">
                            <h5 class="text-center mb-3">Monitoring Loop</h5>
                            <div class="flow-step">
                                <i class="fas fa-sync"></i>
                                <h6>Wait 5 Minutes</h6>
                            </div>
                        </div>

                        <!-- Connecting Lines -->
                        <div style="
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            pointer-events: none;
                            z-index: 1;
                        ">
                            <!-- API to Data Collection -->
                            <div style="
                                position: absolute;
                                top: 50%;
                                left: 30%;
                                width: 20%;
                                height: 2px;
                                background: #0d6efd;
                            "></div>
                            <div style="
                                position: absolute;
                                top: 50%;
                                left: 50%;
                                width: 10px;
                                height: 10px;
                                border-right: 2px solid #0d6efd;
                                border-bottom: 2px solid #0d6efd;
                                transform: rotate(-45deg);
                            "></div>

                            <!-- Data Collection to Storage -->
                            <div style="
                                position: absolute;
                                top: 50%;
                                left: 50%;
                                width: 20%;
                                height: 2px;
                                background: #0d6efd;
                            "></div>
                            <div style="
                                position: absolute;
                                top: 50%;
                                left: 70%;
                                width: 10px;
                                height: 10px;
                                border-right: 2px solid #0d6efd;
                                border-bottom: 2px solid #0d6efd;
                                transform: rotate(-45deg);
                            "></div>

                            <!-- Storage to Loop -->
                            <div style="
                                position: absolute;
                                top: 85%;
                                left: 50%;
                                width: 2px;
                                height: 15%;
                                background: #0d6efd;
                            "></div>
                            <div style="
                                position: absolute;
                                top: 100%;
                                left: 50%;
                                width: 10px;
                                height: 10px;
                                border-right: 2px solid #0d6efd;
                                border-bottom: 2px solid #0d6efd;
                                transform: rotate(45deg);
                            "></div>

                            <!-- Loop back to API -->
                            <div style="
                                position: absolute;
                                top: 100%;
                                left: 30%;
                                width: 40%;
                                height: 2px;
                                background: #0d6efd;
                            "></div>
                            <div style="
                                position: absolute;
                                top: 100%;
                                left: 30%;
                                width: 10px;
                                height: 10px;
                                border-right: 2px solid #0d6efd;
                                border-bottom: 2px solid #0d6efd;
                                transform: rotate(45deg);
                            "></div>
                        </div>
                    </div>
                </div>

                <!-- Comprehensive Flow Tab -->
                <div class="tab-pane fade" id="comprehensive" role="tabpanel" aria-labelledby="comprehensive-tab">
                    <div class="flow-chart-2d" style="
                        display: grid;
                        grid-template-columns: repeat(4, 1fr);
                        grid-template-rows: repeat(4, 1fr);
                        gap: 20px;
                        padding: 20px;
                        position: relative;
                        min-height: 600px;
                    ">
                        <!-- Initialization Section -->
                        <div class="flow-group" style="
                            grid-column: 1;
                            grid-row: 1;
                            background: #e3f2fd;
                            border-radius: 8px;
                            padding: 15px;
                        ">
                            <h5 class="text-center mb-3">Initialization</h5>
                            <div class="flow-step">
                                <i class="fas fa-cog"></i>
                                <h6>Load Config</h6>
                            </div>
                            <div class="flow-step">
                                <i class="fas fa-database"></i>
                                <h6>DB Connection</h6>
                            </div>
                        </div>

                        <!-- API Section -->
                        <div class="flow-group" style="
                            grid-column: 2;
                            grid-row: 1;
                            background: #e8f5e9;
                            border-radius: 8px;
                            padding: 15px;
                        ">
                            <h5 class="text-center mb-3">API Setup</h5>
                            <div class="flow-step">
                                <i class="fas fa-server"></i>
                                <h6>N-Central Auth</h6>
                            </div>
                            <div class="flow-step">
                                <i class="fas fa-desktop"></i>
                                <h6>Get Devices</h6>
                            </div>
                        </div>

                        <!-- Monitoring Section -->
                        <div class="flow-group" style="
                            grid-column: 3;
                            grid-row: 1;
                            background: #fff3e0;
                            border-radius: 8px;
                            padding: 15px;
                        ">
                            <h5 class="text-center mb-3">Monitoring</h5>
                            <div class="flow-step">
                                <i class="fas fa-microchip"></i>
                                <h6>CPU Metrics</h6>
                            </div>
                            <div class="flow-step">
                                <i class="fas fa-memory"></i>
                                <h6>Memory Usage</h6>
                            </div>
                            <div class="flow-step">
                                <i class="fas fa-hdd"></i>
                                <h6>Disk Space</h6>
                            </div>
                        </div>

                        <!-- Data Processing Section -->
                        <div class="flow-group" style="
                            grid-column: 4;
                            grid-row: 1;
                            background: #fce4ec;
                            border-radius: 8px;
                            padding: 15px;
                        ">
                            <h5 class="text-center mb-3">Processing</h5>
                            <div class="flow-step">
                                <i class="fas fa-database"></i>
                                <h6>Store Data</h6>
                            </div>
                            <div class="flow-step">
                                <i class="fas fa-chart-line"></i>
                                <h6>Update Records</h6>
                            </div>
                        </div>

                        <!-- Reporting Section -->
                        <div class="flow-group" style="
                            grid-column: 2 / span 2;
                            grid-row: 2;
                            background: #e1f5fe;
                            border-radius: 8px;
                            padding: 15px;
                        ">
                            <h5 class="text-center mb-3">Reporting</h5>
                            <div class="flow-step">
                                <i class="fas fa-chart-bar"></i>
                                <h6>Weekly Reports</h6>
                            </div>
                            <div class="flow-step">
                                <i class="fas fa-chart-pie"></i>
                                <h6>Monthly Analysis</h6>
                            </div>
                        </div>

                        <!-- System Health Section -->
                        <div class="flow-group" style="
                            grid-column: 1;
                            grid-row: 2;
                            background: #f3e5f5;
                            border-radius: 8px;
                            padding: 15px;
                        ">
                            <h5 class="text-center mb-3">System Health</h5>
                            <div class="flow-step">
                                <i class="fas fa-shield-alt"></i>
                                <h6>Monitor Script</h6>
                            </div>
                            <div class="flow-step">
                                <i class="fas fa-exclamation-triangle"></i>
                                <h6>Check Alerts</h6>
                            </div>
                        </div>

                        <!-- Loop Section -->
                        <div class="flow-group" style="
                            grid-column: 4;
                            grid-row: 2;
                            background: #e8eaf6;
                            border-radius: 8px;
                            padding: 15px;
                        ">
                            <h5 class="text-center mb-3">Loop</h5>
                            <div class="flow-step">
                                <i class="fas fa-sync"></i>
                                <h6>5-Minute Cycle</h6>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity Diagram Tab -->
                <div class="tab-pane fade" id="activity" role="tabpanel" aria-labelledby="activity-tab">
                    <div class="mermaid-container" style="width: 100%; height: 600px; overflow: auto; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                        <div class="mermaid" style="width: 100%; height: 100%;">
                            graph TD
                                subgraph Main System
                                    A[main.py] --> B[Initialize Components]
                                    B --> C[Validate Config]
                                    C --> D[Main Loop]
                                    
                                    D --> E[Reinitialize Config]
                                    E --> F[Process Device Data]
                                    F --> G[Log Process Summary]
                                    G --> D
                                end

                                subgraph Component Initialization
                                    B --> H[Logger Setup]
                                    B --> I[Config Loader]
                                    B --> J[API Client]
                                    B --> K[Device Handler]
                                    B --> L[DB Handler]
                                end

                                subgraph Device Data Processing
                                    F --> M[Get Devices]
                                    M --> N[For Each Device]
                                    N --> O[Get Device Tasks]
                                    O --> P[Get Raw Data]
                                    P --> Q[Format & Insert Data]
                                end

                                subgraph Database Operations
                                    Q --> R[Insert Device Info]
                                    Q --> S[Insert Raw Data]
                                    Q --> T[Insert Data Info]
                                end

                                subgraph Monitoring System
                                    U[monitor.py] --> V[Check API Status]
                                    V --> W[Check Script Status]
                                    W --> X[Restart if Needed]
                                    X --> Y[Send Email Alerts]
                                end

                                subgraph Web Interface
                                    Z[web/app.py] --> AA[Load Config]
                                    AA --> AB[Save Config]
                                    AB --> AC[Render Interface]
                                end

                                %% Connections between subsystems
                                I --> F
                                J --> F
                                K --> F
                                L --> F
                                H --> D
                                Y --> U
                                AC --> I
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        // Initialize Mermaid with more specific settings
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                rankSpacing: 100,
                nodeSpacing: 100,
                rankDir: 'TB'
            },
            securityLevel: 'loose'
        });

        // Initialize Bootstrap tabs and ensure Mermaid renders on tab change
        document.addEventListener('DOMContentLoaded', function() {
            var tabEls = document.querySelectorAll('button[data-bs-toggle="tab"]');
            tabEls.forEach(function(tabEl) {
                new bootstrap.Tab(tabEl);
            });

            // Re-render Mermaid diagrams when tab changes
            document.querySelectorAll('button[data-bs-toggle="tab"]').forEach(function(tab) {
                tab.addEventListener('shown.bs.tab', function (e) {
                    if (e.target.id === 'activity-tab') {
                        // Remove the processed attribute to force re-render
                        const mermaidDiv = document.querySelector('#activity .mermaid');
                        if (mermaidDiv) {
                            mermaidDiv.removeAttribute('data-processed');
                            mermaid.init(undefined, '#activity .mermaid');
                        }
                    }
                });
            });
        });
    </script>
</body>
</html> 